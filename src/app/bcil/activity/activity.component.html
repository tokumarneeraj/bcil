<div class="modal fade" bsModal #editorModal="bs-modal" [config]="{backdrop: 'static'}" tabindex="-1" style="z-index:999999">
    <div class="modal-dialog modal-lg" style="max-height: 600px;
    overflow: auto;">
        <div class="modal-content">
            <div class="modal-header">
                <h4>{{array?.tablename}}</h4>
                <button type="button" class="close float-right" title="Close" (click)="editorModal.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
            </div>
            <div class="modal-body">
              <form [formGroup]="ForwardForm">

                <div class="form-group row" *ngIf="activebtn?.form?.lmassigned">
                  <div class="col-sm-12">
                    <label class="col-form-label">Select Legal Manager</label>

                    <select type="text" class="form-control" formControlName="assigntolm" [ngClass]="{ 'is-invalid': submitted && f.assigntolm.errors }"  [(ngModel)]="selectedlm">
                      <option value="" selected>--select--</option>
                      <option *ngFor="let data of rowslm" value="{{data.id}}">{{data.userName}}</option>

                    </select>


                  </div>
                </div>

                <div class="form-group row" *ngIf="applicationno!='' && applicationno !=null">
                  <div class="col-sm-12">
                    <label class="col-form-label"><b>Application No: {{applicationno}}</b></label>
                   
                  </div>
                </div>
                <div class="form-group row">
                  <div class="col-sm-12">
                    <label class="col-form-label">Title</label>
                    <input type="text" class="form-control" formControlName="subject" [ngClass]="{ 'is-invalid': submitted && f.subject.errors }" />
                    <p *ngIf="submitted && f.subject.errors" class="invalid-feedback">Title is required</p>
                           

                  </div>
                </div>
                <div class="form-group row" *ngIf="activebtn?.form?.typeflied">
                  <div class="col-sm-12">
                    <label class="col-form-label">Type</label>
                    <select type="text" class="form-control" formControlName="type" [ngClass]="{ 'is-invalid': submitted && f.type.errors }">
                      <option value="">Choose</option>
                      <option value="MOU">MOU</option>
                      <option value="NDA">NDA</option>
                      <option value="Work Order">Work Order</option>
                      <option value="Others">Others</option>
                    </select>


                  </div>
                </div>
                <div class="form-group row" *ngIf="array?.foreignlabel">
                  <div class="col-sm-12">
                    <label class="col-form-label">Select Patent Application</label>
                    <select formControlName="foreign" name="foreign" class="form-control">
                      <option *ngFor="let ff of foreignlist" value="{{ff.refid}}">{{ff.appno}}</option>
                    </select>
                </div>
                </div>
                <div class="form-group row" *ngIf="activebtn?.form?.organization || array?.organization">
                  <div class="col-sm-12">
                    <label class="col-form-label">Organization</label>
                    <select type="text"  class="form-control" name="organization" formControlName="organization" (change)="organizationchnage($event.target.value)" [(ngModel)]="selectorg">
                      <option *ngIf="organizations?.length>1" value="" selected>--select--</option>
                      <option  *ngFor="let org of organizations" [attr.data-message-id]="org.key" value="{{org.value}}">{{org.value}}</option>
                      <!-- <option value="MOU">MOU</option>
                      <option value="NDA">NDA</option>
                      <option value="Work Order">Work Order</option>
                      <option value="Others">Others</option> -->
                    </select>

                    <p *ngIf="submitted && f.organization?.errors" class="invalid-feedback">Organization is required</p>
                    
                  </div>
                </div>
                
                <div class="form-group row" *ngIf="activebtn?.form?.prioritydate && prioritydate!=null">
                  <div class="col-sm-12">
                    <label class="col-form-label">Priority Date</label>
                    <p>{{prioritydate |date}}</p>
                    </div>
                    </div>
                <div class="form-group row" *ngIf="activebtn?.form?.assign ||viewassign">
                  <div class="col-sm-12">
                    <label class="col-form-label">{{activebtn?.form?.assignlabel ||array?.assignlabel}}</label>
                    <select type="text" class="form-control" name="assignto" formControlName="assignto" [(ngModel)]="selectassign">
                      <option value=""  selected>--select--</option>
                      <option *ngFor="let user of rowsassign" value="{{user.id}}">{{user.userName}} <span *ngIf="activebtn?.form?.assignarray?.length>1 || array?.assignarray?.length>1">({{user.roles[0]}})</span></option>
                      <!-- <option value="MOU">MOU</option>
                      <option value="NDA">NDA</option>
                      <option value="Work Order">Work Order</option>
                      <option value="Others">Others</option> -->
                    </select>

                    <p *ngIf="submitted && f.assignto?.errors" class="invalid-feedback">{{activebtn?.form?.assignlabel}} is required</p>
                    
                  </div>
                </div>

                <div class="form-group row" *ngIf="activebtn?.form?.bdoassigned">
                    <div class="col-sm-12">
                      <label class="col-form-label">BDM</label>
                      <select type="text" class="form-control" name="assigntobdo" formControlName="assigntobdo" [(ngModel)]="selectedbdm">
                        <option value="" selected>--select--</option>
                        <option *ngFor="let user of rowsbdm" value="{{user.id}}">{{user.userName}}</option>
                        <!-- <option value="MOU">MOU</option>
                        <option value="NDA">NDA</option>
                        <option value="Work Order">Work Order</option>
                        <option value="Others">Others</option> -->
                      </select>
  
  
                    </div>
                  </div>
                  <ng-container *ngIf="activebtn?.form?.nextaction">
                    <div class="row">
                      <div class="col-sm-1">
                        </div>
                  <div class="col-sm-3">
                    <label>Next Action</label>
                    </div>
                    
                      <div class="col-sm-3">
                        <label>DeadLine</label>
                        </div>
                        <div class="col-sm-3">
                      <label>Remarks</label>
                      </div>
                      
                      </div>
                      <div formArrayName="nextactiondata" *ngFor="let item of nextactiondata.controls; let i = index" class="form-group">
                        <div [formGroupName]="i">
                         
                            <input type="hidden" formControlName="ID" />
                           
                              <div class="row">
                                <div class="col-sm-1">
                                  {{i+1}}
                                </div>
                                <div class="col-sm-3">
                                  <input type="text"  class="form-control"  formControlName="nextaction" id="nextaction+i"/>
                                  <p *ngIf="submitted && f.nextaction?.errors" class="invalid-feedback">Next Action is required</p>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                  <input type="date"  class="form-control"  formControlName="deadline" id="deadline+i"/>
                                                                  <p *ngIf="submitted && f.deadline?.errors" class="invalid-feedback">Deadline is required</p>
                                                                                                </div>
                                                                                                <div class="col-sm-3">
                                                                                                  <input type="text"  class="form-control"  formControlName="remarks" id="rmarks+i"/>
                                                                                                 
                                                                                                                                </div>
                                                                                                                                <div class="col-md-1">
                                                                                                                                  <button *ngIf="nextactiondata.length>1" (click)="deletenextactionitem(i)" class="btn btn-sm"><i class="fa fa-trash"></i></button>
                                                                                                                                                                                                               
                                                                                                                                                                                                                               </div>
                                </div>
                                </div>
                                </div>
                                <div class="row">
                                  <div class="col-md-2">
                                    <button class="btn btn-success btn-sm" type="button" (click)="addNextActionItemButtonClick()" ><i class="fa fa-plus"></i></button>
                      
                      
                                  </div>
                                </div>
                  </ng-container>
                  <ng-container *ngIf="activebtn?.form?.milestone">
                  
                  <div class="row">
                    <div class="col-sm-12">

                      <label class="col-form-label">Milestone</label>
                      <div class="row">
                        <div class="col-sm-1">
                          </div>
                    <div class="col-sm-2">
                      <label>Milestone</label>
                      </div>
                      
                        <div class="col-sm-3">
                          <label>Payment term</label>
                          </div>
                          <div class="col-sm-3">
                        <label>Timeline</label>
                        </div>
                        <div class="col-sm-2">
                          <label>Payment Type</label>
                          </div>
                        </div>
                    </div>
                      </div>
                  <div formArrayName="milestonedata" *ngFor="let item of milestonedata.controls; let i = index" class="form-group">
                    <div [formGroupName]="i">
                     
                        <input type="hidden" formControlName="ID" />
                       
                          <div class="row">
                            <div class="col-sm-1">
                              {{i+1}}
                            </div>
                            <div class="col-sm-2">
<input type="text"  class="form-control"  formControlName="milestone" id="milestone+i"/>
<p *ngIf="submitted && f.milestone?.errors" class="invalid-feedback">Milestone is required</p>
                              </div>
                              <div class="col-sm-3">
                                <input type="text"  class="form-control" formControlName="paymentterm" id="paymentterm+i"/>
                                <p *ngIf="submitted && f.paymentterm?.errors" class="invalid-feedback">Milestone is required</p>
                                                              </div>
                                                              <div class="col-sm-3">
                                                                <input type="date"  class="form-control"  formControlName="timeline" id="timeline+i"/>
                                                                <p *ngIf="submitted && f.timeline?.errors" class="invalid-feedback">Milestone is required</p> 
                                                              </div>
                                                              <div class="col-sm-2">
                                                                <select   class="form-control"  formControlName="paymenttype" id="paymenttype+i">
                                                                  <option value="YES" selected>YES</option>
                                                                  <option value="NO">NO</option>
                                                                </select>
                                                                <p *ngIf="submitted && f.paymenttype?.errors" class="invalid-feedback">payment Type is required</p> 
                                                              </div>
      <div class="col-md-1">
 <button *ngIf="milestonedata.length>1" (click)="deleteitem(i)" class="btn btn-sm"><i class="fa fa-trash"></i></button>
                                                                              
                                                                                              </div>
                              </div>
                            
                            </div>

                              </div>
                              <div class="row">
                                <div class="col-md-2">
                                  <button class="btn btn-success btn-sm" type="button" (click)="addItemButtonClick()" ><i class="fa fa-plus"></i></button>
                    
                    
                                </div>
                              </div>
                            </ng-container>
                            <ng-container *ngIf="fields?.length>0" >
                            <form [formGroup]="dynamicForm" >
                            <ng-container *ngFor="let controls of fields">
                              <div class="form-group row" *ngIf="controls.type=='countryselect'" >
                                <label class="col-form-label">Type</label>
                              <select  class="form-control" (change)="onchangepct($event)"  [formControlName]="extrafield[0]"  [(ngModel)]="selectpct">
                                <option value='PCT'>PCT</option>
                                <option value='CONVENTIONAL'>CONVENTIONAL</option>
                              </select>
                            </div>
                              <div class="form-group row">
                                <div class="col-sm-12">
                                  <label class="col-form-label" *ngIf="controls?.hideshow!=false"> {{controls.label |underscore}}</label>
                                 
                                <select *ngIf="controls.type=='countryselect' && selectpct!='PCT'"  [formControlName]="controls.label" class="form-control" >
                                    <option value="">Choose</option>
                                    <option *ngFor="let opt of rowcountry" value="{{opt.name}}">{{opt.name}}</option>
                                    </select> 
                                    <ng-select *ngIf="controls.type=='countryselect' && selectpct=='PCT'" size="1" id="roles-user-info" name="country" [formControlName]="controls.label" (change)="selectedcountry($event)" [items]="rowcountry" bindLabel="name" bindValue="name" [multiple]="true" [closeOnSelect]="false"
                                    placeholder="Select Country"   class="form-control left-status pill-items" required>
                           <ng-template ng-label-tmp let-item="item" let-clear="clear">
                             <span title='{{item.name}}' class='badge badge-pill badge-secondary'>{{item.name}}<span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span></span>
                           </ng-template>
                 
                           <ng-template ng-option-tmp let-item="item">
                             <span title='{{item.name}}' class='badge badge-pill badge-secondary'>{{item.name}}</span>
                             <i class="fa fa-check d-none"></i>
                           </ng-template>
                         </ng-select>
                                  <select *ngIf="controls.type=='select'"  [formControlName]="controls.label" class="form-control">
                                    <option value="">Choose</option>
                                    <option *ngFor="let opt of controls.option" value="{{opt.key}}">{{opt.value}}</option>
                                    </select>
                                    <textarea type="text" class="form-control" *ngIf="controls.type=='textarea'"  [formControlName]="controls.label"
                                    ></textarea>
                             
                              <input [type]="controls.type" class="form-control" *ngIf="(controls.type=='text' || controls.type=='date' || controls.type=='file') && (controls?.hideshow!=false)" (change)="otherfileChangeEvent($event)" [formControlName]="controls.label"/>
                                <ng-container *ngFor="let validation of controls.validations">
                                  <span *ngIf="submitted && dynamicForm.controls[controls.label]?.errors && controls?.hideshow!=false">
                                    <p *ngIf="dynamicForm.controls[controls.label]?.errors[validation.name]" class="invalid-feedback">
                                      {{validation.message}}
                                    </p>
                                  </span>
                              </ng-container>
                              </div>
                              </div>
                            </ng-container>
                            <!-- {{dynamicForm.value|json}} -->
                          </form>
                            </ng-container>
                           
                            <div class="form-group row" *ngIf="activebtn?.form?.mappedinvoice">
                             
                              <div class="col-sm-12">
                                <label class="col-form-label">Select Client Invoice</label>
                                <ng-select  size="1" id="roles-user-info" formControlName="clientinvocie" name="clientinvocie"  (change)="selectedclient($event)" [items]="clientinvoice" bindLabel="invoiceno" bindValue="appno" [multiple]="true" [closeOnSelect]="false"
                                placeholder="Select Client Invoice"   class="form-control left-status pill-items" required>
                       <ng-template ng-label-tmp let-item="item" let-clear="clear">
                         <span title='{{item.invoiceno}}' class='badge badge-pill badge-secondary'>{{item.invoiceno}}<span class="ng-value-icon right" (click)="clear(item)" aria-hidden="true">×</span></span>
                       </ng-template>
             
                       <ng-template ng-option-tmp let-item="item">
                         <span title='{{item.invoiceno}}' class='badge badge-pill badge-secondary'>{{item.invoiceno}}</span>
                         <i class="fa fa-check d-none"></i>
                       </ng-template>
                     </ng-select>
                              </div>
                            </div>
                <div class="form-group row">
                  <div class="col-sm-12">
                    <label class="col-form-label">Remarks</label>
                    <textarea type="text" class="form-control" formControlName="remarks" [ngClass]="{ 'is-invalid': submitted && f.remarks.errors }">
                                </textarea>
                                 <p *ngIf="submitted && f.remarks?.errors" class="invalid-feedback">Remarks is required</p> 
                                                              

                  </div>
                </div>
                <div class="form-group row" *ngIf="activebtn?.form?.toggle">
                  <div class="col-sm-9"></div>
                  <div class="col-sm-3">
                    <label class="col-form-label">boolean check</label>
                    <input type="checkbox" class="form-control" formControlName="booleanvalue"  />
                   

                  </div>
                </div>
                <div class="form-group row">
                  <div class="col-sm-12">
                    <label class="col-form-label">Upload</label>
                    <input type="file" accept="*" class="form-control" (change)="fileChangeEvent($event)" />
                    <input type="hidden" name="files" formControlName="files" /> 
                    <p *ngIf="submitted && f.files.errors" class="invalid-feedback">File is required</p>
                  
                    <span class="text-danger float-right">*For multiple files, please compress and upload.(zip format)</span>

                  </div>
                </div>

                <div class="form-group row"  *ngIf="activebtn?.form?.reminder">
<div class="col-sm-6"> 
    <label class="col-form-label">Default Reminder</label>
    <input type="radio" class="form-control" name="remindertype" value="default"  formControlName="remindertype" (change)="reminderchange('default')"/>
 
</div>
    <div class="col-sm-6"> 
        <label class="col-form-label">Custom Reminder</label>
        <input type="radio" class="form-control" name="remindertype" value="custom" formControlName="remindertype" (change)="reminderchange('custom')"/>
           
                  </div>
                </div>
                 <div class="form-group row"  *ngIf="activebtn?.form?.reminder">
                    <app-reminder *ngIf="customrem" [customrem]="customrem" [appref]="appref" [type]="type" style="width:100%"></app-reminder>
                 </div>

                
                   
              

                <div class="form-group row">
                  <div class="col-sm-6">
                    <!-- <button type="submit"
                            class="btn btn-success"
                            (click)="uploadFile()">
                      Upload File
                    </button> -->
                    <button type="submit" class="btn btn-success"  (click)="uploadFile()" [disabled]="loading">
                        <i *ngIf="loading" class='fa fa-circle-o-notch fa-spin'></i> {{loading ? 'Saving...' : 'Save'}}
                      </button>
                  </div>
                  

                </div>


              </form>
                <!-- <ul class="list-unstyled">
                    <li *ngFor="let role of rows"><input type="checkbox" name="checkbox-{{role.name}}" [disabled]="!canManageRoles" [(ngModel)]="selectedValues1[role.id+uservalue]" />{{role.name}}</li>
                </ul>
                <button type="button" [ngClass]="!canManageRoles ? 'd-none': ''" [disabled]="!canManageRoles" (click)="addrolepermissionsubmit()" class="btn btn-sm btn-outline-primary"><i class="fa fa-save"></i> Submit</button> -->

            </div>
        </div>
    </div>
  </div>